<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.neutech.mapper.CheckoutRecordMapper">
    <select id="getCheckoutApplications" resultType="map">
        SELECT cr.checkout_id, cr.user_id, u.name, cr.bed_id
        FROM checkout_record cr
        JOIN user u ON cr.user_id = u.id_card
    </select>

    <select id="getCheckoutApplicationsByUserId" resultType="map">
        SELECT cr.checkout_id, cr.user_id, u.name, cr.bed_id
        FROM checkout_record cr
        JOIN user u ON cr.user_id = u.id_card
        WHERE cr.user_id = #{user_id}
    </select>

    <update id="approveApplication">
        UPDATE checkout_record
        SET status = '已通过'
        WHERE user_id = #{user_id}
    </update>

    <update id="rejectApplication">
        UPDATE checkout_record
        SET status = '未通过'
        WHERE user_id = #{user_id}
    </update>

    <update id="updateApplication">
        UPDATE checkout_record
        SET user_id = #{user_id},
            bed_id = #{bed_id},
            checkout_time = #{checkout_time}
        WHERE user_id = #{user_id}
    </update>

    <delete id="deleteApplication">
        DELETE FROM checkout_record
        WHERE user_id = #{user_id}
    </delete>

    <update id="updateBedStatus">
        UPDATE bed
        SET status = '空闲', user_id = NULL
        WHERE bed_id = #{bed_id}
    </update>
</mapper>